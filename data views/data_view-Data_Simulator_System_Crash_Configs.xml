<data_view_info name="Data Simulator System Crash Configs" table="ds_crash_system_config" show_summary="f" group_fields="t">
	<columns>
		<column path="name" show_in_table="t"/>
		<column path="description" show_in_table="t"/>
		<column path="order" show_in_table="f"/>
		<column path="type" show_in_table="f"/>
		<column path="value" show_in_table="t"/>
		<column path="var_name" show_in_table="f"/>
		<column custom_control="Colored Status" show_in_table="t" label="Error Message">
			<attributes>
				<path><![CDATA[_calc:error_message::string:"var mgr = dbApi.getEntityManager();
var name = get(\"Name\");
var value = get(\"Value\");
var retVal = \"\";

if (name == \"System Crash Minimum\") {

    if (parseInt(value) < 0 || parseInt(value) > 20)
        retVal = \"This value must be 0 or greater and less than 20.\";    
    
} else if (name == \"System Crash Maximum\") {

    if (parseInt(value) < 0 || parseInt(value) > 20)
        retVal = \"This value must be 0 or greater and less than 20.\";    
    
} else if (name == \"Start Date\" || name == \"End Date\") {

    var isValid = false;
    var startDate = null, endDate = null;
    var configs = this.mgr.readLazily(\"ds_crash_system_config\", Criterion.IN(\"name\", [\"Start Date\", \"End Date\"]));
    while (configs.hasNext()) {
     
        var config = configs.next();
        var cfgValue = config.get('value');
        if (cfgValue) {
            
            // Date check functions did not work, so using try/catch                    
            try {
                var dt = new java.util.Date(cfgValue);
                isValid = true;            
            } catch (e) {
                retVal = \"Please enter a valid date in dd/mm/yyyy format.\";
                isValid = false;            
            }
            
            if (isValid) {        
                if (config.get('name') == \"Start Date\")
                    startDate = new java.util.Date(cfgValue);
                else
                    endDate = new java.util.Date(cfgValue);                              
            }
        }        
    }
    
    if (isValid) {
        if (config.get('name') == \"Start Date\")
            startDate = new java.util.Date(cfgValue);
        else
            endDate = new java.util.Date(cfgValue);  
         
        if (startDate && endDate) {
                      
            if (startDate.getTime() > endDate.getTime()) {
                retVal = \"The Start Date must be less than the End Date.\";  
            }
        } else {    
            retVal = \"The Start Date and End Date must not be empty.\";
        } 
    } 
         
} else if (name == \"Exclude Weekends\") {
    
    if (value != \"TRUE\" && value != \"FALSE\") 
        retVal = \"Please enter TRUE or FALSE.\";
    
} else if (name == \"Scatter Percentage\") {
    
    if (parseInt(value) < 0 || parseInt(value) > 100)
        retVal = \"This value must be between 0 and 100.\";  
    
}

if (retVal != \"\") retVal += \":#b00\";

retVal;":]]></path>
			</attributes>
		</column>
	</columns>
	<controls>
		<control name="Colored Status">
			<attributes>
				<renderer><![CDATA[if ($ctx.value == null || $ctx.value === '') {
    '';
} else {
    var split = $ctx.value.split(':');
    var label = split[0];
    var color = '#EEE';
    var marker = 0;
    if (split.length > 1) {
		color = split[1];
    }
    if (split.length > 2) {
		marker = split[2];
    }
    var style = ';font-weight:normal;width:100%;border-radius:5px;box-shadow:0 1px 1px #CCC;color:#FFF;padding:3px 5px 0 5px;height:22px;box-sizing:border-box;';
    var clazz = 'status-sm ' + label.toLowerCase() +'';
    '<div class=\"'+ clazz +'\" data-marker=\"'+ marker + '\" style=\"background-color:'+ color + style  + '\">'+ label +'</div>'
}]]></renderer>
			</attributes>
		</control>
	</controls>
</data_view_info>